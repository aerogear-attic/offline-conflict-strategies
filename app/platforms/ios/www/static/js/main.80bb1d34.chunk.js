(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,n){e.exports=n(212)},112:function(e,t,n){},116:function(e,t,n){},157:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,c)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(211),c=n(163),s=n(209),u=n(165),l=n(88);t.createClient=function(e){return r(i,void 0,void 0,function(){var t,n,i;return a(this,function(f){switch(f.label){case 0:return[4,function(e){return r(this,void 0,void 0,function(){var t,n;return a(this,function(r){switch(r.label){case 0:return t=new o.InMemoryCache({dataIdFromObject:function(){return e.dataIdFromObject}}),n=e.storage,[4,c.persistCache({cache:t,storage:n})];case 1:return r.sent(),[2,t]}})})}(t=function(e){var t=new u.SyncConfig,n=t.merge(e);return t.applyPlatformConfig(n),t.validate(t),n}(e))];case 1:return n=f.sent(),i=l.defaultLinkBuilder(t),[2,new s.ApolloClient({link:i,cache:n})]}})})}},165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(166),a=n(196),i=function(){function e(){this.dataIdFromObject="id",this.storage=window.localStorage}return e.prototype.merge=function(e){return Object.assign(this,e)},e.prototype.applyPlatformConfig=function(e){var t=r.INSTANCE.getConfigByType("sync");if(t&&t.length>0){var n=t[0];e.httpUrl=n.url}},e.prototype.validate=function(e){if(!e.httpUrl)throw new a.ConfigError("Missing server URL","httpUrl")},e}();t.SyncConfig=i},196:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.fieldName=n,r}return r(t,e),t}(Error);t.ConfigError=a},197:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(198),a=n(89);t.conflictLink=function(e){return r.onError(function(t){var n=t.operation,r=t.forward,i=function(e){if(e)for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.extensions&&"AgSync:DataConflict"===r.extensions.exception.type)return r.extensions.exception.data}}(t.graphQLErrors),o=(e.conflictStrategy?e.conflictStrategy:a.strategies.diffMergeClientWins)(i,n.variables);return o.version=i.version,n.variables=o,r(n)})}},200:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(215);t.defaultWebSocketLink=function(e){var t=e.options||{};return new r.WebSocketLink({uri:e.uri,options:{connectionParams:t.connectionParams,connectionCallback:t.connectionCallback,timeout:t.timeout||1e4,inactivityTimeout:1e4,reconnectionAttempts:t.reconnectionAttempts||500,reconnect:!0,lazy:!0}})}},212:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(90),o=n.n(i),c=(n(112),n(4)),s=n.n(c),u=n(8),l=n(14),f=n(20),d=n(24),p=n(21),h=n(23),v=(n(116),n(17)),m=n(40),b=n(41),y=n(29),O=n(220),g=n(221),w=n(213),j=n(222),k=n(37),U=n.n(k),S=n(96),E=n(26),C=n(22),_=n.n(C);function x(){var e=Object(E.a)(["\n  subscription userCreated {\n    userCreated {\n      id\n      name\n      dateOfBirth\n      version\n    }\n  }\n"]);return x=function(){return e},e}function M(){var e=Object(E.a)(["\nmutation updateUser($dateOfBirth: String, $id: ID!, $name: String, $version: Int!) {\n  updateUser(dateOfBirth: $dateOfBirth, id: $id, name: $name, version: $version) {\n    dateOfBirth\n    id\n    name\n    version\n  }\n}\n"]);return M=function(){return e},e}function D(){var e=Object(E.a)(["\nmutation deleteUser($id: ID!){\n  deleteUser(id: $id){\n    id\n    name\n    dateOfBirth\n    version\n  }\n}\n"]);return D=function(){return e},e}function B(){var e=Object(E.a)(["\n  query allUsers($first: Int) {\n    allUsers(first: $first){\n      id\n      name\n      dateOfBirth\n      version\n    }\n}\n"]);return B=function(){return e},e}function A(){var e=Object(E.a)(["\nmutation createUser($dateOfBirth: String!, $name: String!){\n    createUser(dateOfBirth: $dateOfBirth, name: $name){\n      id\n      name\n      dateOfBirth\n      version\n    }\n  }\n"]);return A=function(){return e},e}var L=_()(A()),P=_()(B()),q=_()(D()),$=_()(M()),I=_()(x()),N=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return a.a.createElement(O.a,{striped:!0,bordered:!0,condensed:!0,hover:!0},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Name"),a.a.createElement("th",null,"Date"),a.a.createElement("th",null,"Action"))),a.a.createElement("tbody",null,this.props.allUsers.map(function(e,t){return a.a.createElement(R,Object.assign({key:t},{item:e}))})))}}]),t}(a.a.Component),Q=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={first:Number(e.first)},n.handleLoadMore=n.handleLoadMore.bind(Object(y.a)(Object(y.a)(n))),n}return Object(h.a)(t,e),Object(f.a)(t,[{key:"handleLoadMore",value:function(e){this.setState(function(e){return{first:2*e.first}}),e({variables:{first:this.state.first},updateQuery:function(e,t){var n=t.fetchMoreResult;return n?Object.assign({},e,{allUsers:Object(b.a)(e.allUsers).concat(Object(b.a)(n.allUsers))}):e}})}},{key:"handleSubscribeForMore",value:function(e){this.userUpdatesSubscription?console.log("Already subscribed to UserCreated updates."):this.userUpdatesSubscription=e({document:I,updateQuery:this.subscriptionUpdate})}},{key:"subscriptionUpdate",value:function(e,t){var n=t.subscriptionData;if(console.log(e,n),!n.data)return e;if(e.allUsers&&Array.isArray(e.allUsers)){var r=n.data.userCreated;return console.log("Added new item using subscription",r),{allUsers:Object(b.a)(e.allUsers).concat([r])}}return e}},{key:"render",value:function(){var e=this;return a.a.createElement(v.Query,{query:P,fetchPolicy:"cache-and-network",errorPolicy:"all"},function(t){var n=t.networkStatus,r=t.subscribeToMore,i=t.fetchMore,o=t.refetch,c=t.error,s=t.data,u=(void 0===s?{}:s).allUsers,l=void 0===u?[]:u;return c&&8===n&&console.info("Network error. Using cached data",l),a.a.createElement("div",null,a.a.createElement(N,{allUsers:l}),a.a.createElement(g.a,null,a.a.createElement(w.a,{bsStyle:"success",onClick:function(){return o()}},"Refresh"),a.a.createElement(w.a,{bsStyle:"info",onClick:function(){return e.handleLoadMore(i)}},"Load more"),a.a.createElement(w.a,{bsStyle:"info",onClick:function(){return e.handleSubscribeForMore(r)}},"Subscribe for more")))})}}]),t}(a.a.Component),R=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this))).state={loading:!1,isOffline:!1},e.updateList=function(e){var t=e.readQuery({query:P}).allUsers;e.writeQuery({query:P,data:{allUsers:t}})},e.onUpdate=function(){var t=Object(u.a)(s.a.mark(function t(n){var r,a,i,o,c;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.item,a=e.props.client,i=e.state.isOffline,o={name:"".concat(r.name,"_").concat(S.Utils.generateId(1)),dateOfBirth:(new U.a).toString(),id:r.id,version:r.version},c={__typename:"Mutation",updateUser:Object(m.a)({__typename:"User"},o)},e.setState({loading:!0}),!i){t.next=11;break}a.mutate({mutation:$,variables:o,optimisticResponse:c,errorPolicy:"all",update:e.updateList}),e.setState({loading:!1}),t.next=17;break;case 11:return t.prev=11,t.next=14,a.mutate({mutation:$,variables:o,optimisticResponse:c,errorPolicy:"all",refetchQueries:[{query:P}]});case 14:return t.prev=14,e.setState({loading:!1}),t.finish(14);case 17:case"end":return t.stop()}},t,this,[[11,,14,17]])}));return function(e){return t.apply(this,arguments)}}(),e.incrementVersion=function(e){return e+1},e.updateDelete=function(e,t){var n=t.data.deleteUser,r=e.readQuery({query:P}).allUsers.filter(function(e){return n.id!==e.id});e.writeQuery({query:P,data:{allUsers:r}})},e.onDelete=function(){var t=Object(u.a)(s.a.mark(function t(n){var r,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.item,a=e.props.client,i={id:r.id},e.setState({loading:!0}),t.next=6,a.mutate({mutation:q,variables:i,update:e.updateDelete});case 6:e.setState({loading:!1});case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),window.addEventListener("online",function(){return e.setState({isOffline:!1})}),window.addEventListener("offline",function(){return e.setState({isOffline:!0})}),e}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t=this.props.item,n=this.state.loading;return a.a.createElement("tr",null,a.a.createElement("td",null,t.name),a.a.createElement("td",null,t.dateOfBirth.toString()),a.a.createElement("td",null,a.a.createElement(j.a,null,a.a.createElement(w.a,{bsStyle:"warning",disabled:n,onClick:function(){return e.onUpdate({item:t})}},"Update"),a.a.createElement(w.a,{bsStyle:"danger",disabled:n,onClick:function(){return e.onDelete({item:t})}},"Delete"))))}}]),t}(a.a.Component);R=Object(v.withApollo)(R);var W=function(e,t,n){var r={__typename:"Mutation"};return r[e]=Object(m.a)({__typename:t},n,{version:1,optimisticResponse:!0}),r[e].id=function(){for(var e="",t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;n>0;n-=1)e+=t[Math.floor(Math.random()*t.length)];return e}(),r},F=function(e,t){var n=t.data.createUser,r=e.readQuery({query:P}).allUsers;e.writeQuery({query:P,data:{allUsers:r.concat([n])}})},T=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(a)))).state={name:"User 1",dateOfBirth:new Date,counter:1},n}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e,t=this;return a.a.createElement("div",{style:{marginTop:"10px",marginBottom:"10px"}},a.a.createElement(v.Mutation,{mutation:L,update:F,optimisticResponse:(e=this.state,W("createUser","User",e))},function(e){return a.a.createElement(w.a,{bsStyle:"primary",onClick:function(){e({variables:{name:t.state.name,dateOfBirth:t.state.dateOfBirth}});var n=t.state.counter+1;t.setState({name:"User ".concat(n),dateOfBirth:new Date,counter:n})}},"Add new")}))}}]),t}(a.a.Component),J=n(54),K=function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"http://localhost:4000/graphql","ws://localhost:4000/graphql",e.next=4,Object(J.createClient)({httpUrl:"http://localhost:4000/graphql",wsUrl:"ws://localhost:4000/graphql",conflictStrategy:J.strategies.diffMergeClientWins});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),G=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.apolloClient,a=n.storage;if(Object(l.a)(this,e),this.getOfflineData=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.storage.getItem(t.storeKey));case 1:case"end":return e.stop()}},e,this)})),this.hasOfflineData=function(){return!!(t.offlineData&&t.offlineData.length>0)},this.addOfflineData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e&&e.length>0&&t.storage.setItem(t.storeKey,JSON.stringify(e))},this.clearOfflineData=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.offlineData=[],e.abrupt("return",t.storage.removeItem(t.storeKey));case 2:case"end":return e.stop()}},e,this)})),this.init=Object(u.a)(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getOfflineData();case 2:n=e.sent,t.offlineData=JSON.parse(n)||[];case 4:case"end":return e.stop()}},e,this)})),this.sync=Object(u.a)(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.hasOfflineData()){e.next=2;break}return e.abrupt("return");case 2:return n=[],e.next=5,Promise.all(t.offlineData.map(function(){var e=Object(u.a)(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.apolloClient.mutate(r);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),n.push(r);case 8:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.next=7,t.clearOfflineData();case 7:t.addOfflineData(n);case 8:case"end":return e.stop()}},e,this)})),!r)throw new Error("Apollo Client instance is required when syncing data, please assign value to it");if(!a)throw new Error("Storage can be window.localStorage or AsyncStorage but was not set");this.apolloClient=r,this.storage=a,this.storeKey="offline-mutation-store",this.offlineData=[]},z=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(a)))).state={apolloClient:null},n}return Object(h.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:return t=e.sent,n=new G({apolloClient:t,storage:window.localStorage}),e.next=6,n.init();case 6:return e.next=8,n.sync();case 8:this.setState({apolloClient:t});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.apolloClient;return e?a.a.createElement(v.ApolloProvider,{client:e},a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("h1",{className:"App-title"},"AeroGear Sync Offline"))),a.a.createElement("div",{className:"container"},a.a.createElement(T,null),a.a.createElement(Q,{first:"3"}),a.a.createElement("div",null)))):"Loading the app"}}]),t}(r.Component);o.a.render(a.a.createElement(z,null),document.getElementById("root"))},54:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(157)),r(n(88)),r(n(89))},88:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),a=n(214),i=n(7),o=n(197),c=n(200);t.defaultLinkBuilder=function(e){if(e.customLinkBuilder)return e.customLinkBuilder(e);var t,n=[new a.HttpLink({uri:e.httpUrl})];if(e.conflictStrategy&&n.unshift(o.conflictLink(e)),t=r.ApolloLink.from(n),e.wsUrl){var s=c.defaultWebSocketLink({uri:e.wsUrl});t=r.split(function(e){var t=e.query,n=i.getMainDefinition(t),r=n.kind,a=n.operation;return"OperationDefinition"===r&&"subscription"===a},s,t)}return t}},89:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(199));t.strategies={diffMergeClientWins:function(e,t){return a.default(e,t)},diffMergeServerWins:function(e,t){return a.default(t,e)}}}},[[107,2,1]]]);
//# sourceMappingURL=main.80bb1d34.chunk.js.map